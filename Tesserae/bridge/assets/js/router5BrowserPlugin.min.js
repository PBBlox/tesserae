!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.router5BrowserPlugin=t()}(this,function(){"use strict";var e={ROUTER_NOT_STARTED:"NOT_STARTED",NO_START_PATH_OR_STATE:"NO_START_PATH_OR_STATE",ROUTER_ALREADY_STARTED:"ALREADY_STARTED",ROUTE_NOT_FOUND:"ROUTE_NOT_FOUND",SAME_STATES:"SAME_STATES",CANNOT_DEACTIVATE:"CANNOT_DEACTIVATE",CANNOT_ACTIVATE:"CANNOT_ACTIVATE",TRANSITION_ERR:"TRANSITION_ERR",TRANSITION_CANCELLED:"CANCELLED"},t={UNKNOWN_ROUTE:"@@router5/UNKNOWN_ROUTE",ROUTER_START:"$start",ROUTER_STOP:"$stop",TRANSITION_START:"$$start",TRANSITION_CANCEL:"$$cancel",TRANSITION_SUCCESS:"$$success",TRANSITION_ERROR:"$$error"},a=function(e){return function(){return e}},n=function(){},r="undefined"!=typeof window&&window.history?{getBase:function(){return window.location.pathname},pushState:function(e,t,a){return window.history.pushState(e,t,a)},replaceState:function(e,t,a){return window.history.replaceState(e,t,a)},addPopstateListener:function(e,t){var a=t.useHash&&!(-1===window.navigator.userAgent.indexOf("Trident"));return window.addEventListener("popstate",e),a&&window.addEventListener("hashchange",e),function(){window.removeEventListener("popstate",e),a&&window.removeEventListener("hashchange",e)}},getLocation:function(e){return((e.useHash?window.location.hash.replace(new RegExp("^#"+e.hashPrefix),""):window.location.pathname.replace(new RegExp("^"+e.base),"")).replace(/\|/g,"%7C")||"/")+window.location.search},getState:function(){return window.history.state},getHash:function(){return window.location.hash}}:{getBase:a(""),pushState:n,replaceState:n,addPopstateListener:n,getLocation:a(""),getState:a(null),getHash:a("")};var o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},i={forceDeactivate:!0,useHash:!1,hashPrefix:"",base:!1,mergeState:!1,preserveHash:!0},s="popstate";return function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r,u=o({},i,a),c={forceDeactivate:u.forceDeactivate,source:s},T=void 0;function l(a){var r=a.getOptions(),i=a.start;function l(e,t,a){var r=e?{meta:e.meta,name:e.name,params:e.params,path:e.path}:e,i=!0===u.mergeState?o({},n.getState(),r):r;a?n.replaceState(i,"",t):n.pushState(i,"",t)}function p(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},T=a.getState(),p=!i.state||!i.state.name,h=p?a.matchPath(n.getLocation(u),s):a.makeState(i.state.name,i.state.params,i.state.path,o({},i.state.meta,{source:s}),i.state.meta.id),d=r.defaultRoute,f=r.defaultParams;h?T&&a.areStatesEqual(h,T,!1)||a.transitionToState(h,T,c,function(n,r){if(n)if(n.redirect){var i=n.redirect,s=i.name,u=i.params;a.navigate(s,u,o({},c,{replace:!0,force:!0,redirected:!0}))}else if(n.code===e.CANNOT_DEACTIVATE){var S=a.buildUrl(T.name,T.params);p||l(h,S,!0)}else d&&a.navigate(d,f,o({},c,{reload:!0,replace:!0}));else a.invokeEventListeners(t.TRANSITION_SUCCESS,r,T,{replace:!0})}):d&&a.navigateToDefault(o({},c,{reload:!0,replace:!0}))}return function(e,t){function a(e){var a=e.match(/^(?:http|https):\/\/(?:[0-9a-z_\-.:]+?)(?=\/)(.*)$/),n=(a?a[1]:e).match(/^(.+?)(#.+?)?(\?.+)?$/);if(!n)throw new Error("[router5] Could not parse url "+e);var r=n[1],o=n[2]||"",i=n[3]||"";return(t.useHash?o.replace(new RegExp("^#"+t.hashPrefix),""):t.base?r.replace(new RegExp("^"+t.base),""):r)+i}e.urlToPath=a,e.buildUrl=function(a,n){var r=t.base||"",o=t.useHash?"#"+t.hashPrefix:"",i=e.buildPath(a,n);return null===i?null:r+o+i},e.matchUrl=function(t){return e.matchPath(a(t))}}(a,u),a.start=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return 0===t.length||"function"==typeof t[0]?i.apply(void 0,[n.getLocation(u)].concat(t)):i.apply(void 0,t),a},a.replaceHistoryState=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=a.buildState(e,t),o=a.buildUrl(e,t);a.lastKnownState=r,n.replaceState(r,"",o)},{onStart:function(){u.useHash&&!u.base&&(u.base=n.getBase()),T=n.addPopstateListener(p,u)},onStop:function(){T&&T()},onTransitionSuccess:function(e,t,r){var o=n.getState(),i=o&&o.meta&&o.name&&o.params,s=t&&a.areStatesEqual(t,e,!1),c=r.replace||!i||s,T=a.buildUrl(e.name,e.params);null===t&&!1===u.useHash&&!0===u.preserveHash&&(T+=n.getHash()),l(e,T,c)},onPopState:p}}return l.pluginName="BROWSER_PLUGIN",l}});
